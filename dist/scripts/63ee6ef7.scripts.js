"use strict";var ServiceConfig={api:"http://api.photomap.local/"};angular.module("photomapApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui-rangeSlider","angularFileUpload","google-maps".ns()]).config(["GoogleMapApiProvider".ns(),function(a){a.configure({v:"3.17",libraries:"weather,geometry,visualization"})}]).config(function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/upload",{templateUrl:"views/upload.html",controller:"UploadCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}),angular.module("photomapApp").controller("MainCtrl",["$scope","Pictures","GoogleMapApi".ns(),function(a,b,c){function d(c,d){c&&d&&b.getPicturesInRange(c,d,function(b,c){a.markers=[],console.log("total pics ",c.length),c.forEach(function(b,c){a.markers.push({latitude:b.lonlat[1],longitude:b.lonlat[0],title:b.name,year:b.year,lon:b.lonlat[0],lat:b.lonlat[1],thumb:ServiceConfig.api+"pictures?filePath="+b.thumb,id:c,date:moment.utc(b.timestamp,"X").format("YYYY-MM-DD"),show:!1,options:{content:"test"+c},handleMarkerClick:function(a,b,c){console.log("I was clicked",this,a,c),this.show=!this.show}})})})}function e(){h||(h=a.years.max);var b=h+"/"+l+"/01";console.log("to year",b);var c=moment(b);j=c.endOf("month"),j=j.unix(),console.log("to date ",j)}function f(){var a=g+"/"+k+"/01";console.log("from date ",a),i=moment(a).unix(),console.log("from date ",i)}a.map={center:{latitude:52,longitude:-7.3},zoom:8},a.markers=[],a.years={min:Number(1990),max:Number(2014)},a.quantity=7,a.months={min:1,max:12,from:1,to:moment().get("month")+1},b.getYearRange("maleck13",function(b,c){console.log("err ",b,c),c.sort(),b&&console.log("err ",b);for(var d=Number(c[0]),e=Number(c[c.length-1]),f=0;f<c.length;f++){var g=Number(c[f]);d>g?d=g:g>e&&(e=g)}var h=c.length;c.length>=2&&(h-=3),a.years={min:Number(c[0]),max:Number(c[c.length-1]),from:Number(c[h]),to:Number(c[c.length-1])}});var g,h,i,j,k=1,l=12;a.$watch("years.from",function(){if(console.log("hey, myVar has changed!",this),this.last){var a=g;if(g=this.last,Number(a)===Number(g))return;console.log("from year changed requesting pics ",a,g),f(),e(),d(i,j)}}),a.$watch("years.to",function(){if(console.log("hey, myVar has changed!",this),this.last){var a=h;if(h=this.last,Number(a)==Number(h))return;console.log("year changed requesting pics ",a,h),e(),f(),d(i,j)}}),a.$watch("months.to",function(){if(this.last){var a=l;if(l=this.last,Number(l)===Number(a))return;e(),f(),d(i,j)}}),a.$watch("months.from",function(){if(this.last){var a=k;if(k=this.last,Number(k)===Number(a))return;e(),f(),d(i,j)}}),c.then(function(){console.log("maps ready")})}]),angular.module("photomapApp").factory("Pictures",["$http","$location","$cookieStore",function(a){return{getYearRange:function(b,c){a({method:"get",url:ServiceConfig.api+"pictures/range/"+b}).success(function(a){console.log("all good ",a),c(void 0,a)}).error(function(a,b){console.log(a,b),c(a)})},getPicturesInRange:function(b,c,d){a({method:"get",url:ServiceConfig.api+"pictures/"+b+"/"+c}).success(function(a){d(void 0,a)}).error(function(a,b){console.log(a,b),d(a)})}}}]),angular.module("photomapApp").controller("UploadCtrl",["$scope","$upload",function(a,b){a.onFileSelect=function(c){for(var d=0;d<c.length;d++){var e=c[d];a.upload=b.upload({url:ServiceConfig.api+"pictures/upload",data:{myObj:a.myModelObj},file:e}).progress(function(a){console.log("percent: "+parseInt(100*a.loaded/a.total))}).success(function(a){console.log(a)})}}}]),angular.module("photomapApp").controller("RegisterCtrl",["scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("photomapApp").controller("LoginCtrl",["scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);